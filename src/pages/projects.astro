---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

// Mantener la lista de proyectos
const projects = [
  {
    title: "ReadWave (En desarrollo)",
    description:
      "En desarrollo. Esta aplicación permitirá a los usuarios descubrir nuevos libros y autores, usando una inteligencia artificial que recomendará nuevos libros basados en los gustos del usuario. Para ello haré uso de la api de google books y google recomendations ai para ajustar los gustos. También se hará uso de Appwrite",
    framework: "Flutter",
    fecha: "2025",
    empresa: "",
    empresaLink: "https://hyliacom.es/",
    image: "/images/readwave.webp",
    mobileImage: "/images/readwave-mobile.png",
    link: "https://sergioem.dev",
    skills: ["Flutter", "Dart"],
  },
  {
    title: "Red de pueblo",
    description:
      "Red de pueblo es una aplicación que permite a los usuarios de las zonas más rurales de España poder comunicarse, compartir servicios y consultar puntos de interés. He usado los mapas de google para geolocalizar los pois y un inicio de sesión con firebase para la autenticación de los usuarios.",
    framework: "Flutter",
    fecha: "2024",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/redpueblo.webp",
    mobileImage: "/images/redpueblo-mobile.png",
    link: "https://play.google.com/store/apps/details?id=com.hyliaapps.reddepueblo",
    skills: ["Flutter", "Dart"],
  },
  {
    title: "EasyClient: Gestión de tiendas",
    description:
      "Los clientes de Hyliacom pueden gestionar sus tiendas desde esta aplicación, pudiendo ver las ventas, productos y clientes junto con un chat de asistencia directa. Para la conexión del chat se ha usado una conexión con el webservice de Hyliacom.",
    framework: "Flutter",
    fecha: "2024",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/easyclient.webp",
    mobileImage: "/images/easyclient-mobile.png",
    link: "https://play.google.com/store/apps/details?id=com.hyliaapps.tiendaseasyclient",
    skills: ["Flutter", "Dart"],
  },
  {
    title: "EasyClient POS (En desarrollo)",
    description:
      "Aplicación de escritorio para la gestión de impresoras de tickets y etiquetas. Esta aplicación se conecta al framework de EasyClient mediante websockets en un servidor de Node.js para la impresión de tickets y etiquetas enviadas directamente desde la web.",
    framework: "Flutter Desktop",
    fecha: "2024",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/easyclient.webp",
    mobileImage: "/images/easyclientpos-mobile.png",
    skills: ["Flutter", "Dart"],
  },
  {
    title: "CRM Cafés Lúa",
    description:
      "Proyecto desarrollado para la empresa gallega Cafés Lúa. Se trata de un CRM para la gestión de citas y rutas de los comerciales y repartidores.",
    framework: "Flutter",
    fecha: "2023",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/lua.webp",
    mobileImage: "/images/lua-mobile.png",
    link: "https://play.google.com/store/apps/details?id=com.hyliaapps.cafeslua",
    skills: ["Flutter", "Dart"],
  },

  {
    title: "Maat Mirror",
    description:
      "Prototipo para ópticas que permite a los clientes probarse las gafas sin necesidad de hacerlo físicamente. Se usan tecnologias como Mlkit para el reconocimiento facial y DeepAR para el renderizado de las gafas.",
    framework: "Flutter",
    fecha: "2023",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/maatmirror.webp",
    mobileImage: "/images/maatmirror-mobile.png",
    link: "https://play.google.com/store/apps/details?id=com.hyliaapps.maatmirror",
    skills: ["Flutter", "Dart"],
  },
  {
    title: "Ana Simó Valencia Ultramar",
    description:
      "Pasteleria en Ferrol (A Coruña) con más de 50 años de experiencia. En esta app se puede ver el catalogo de productos con un diseño adaptado a tablets y móviles.",
    framework: "Flutter",
    fecha: "2023",
    empresa: "Hyliacom",
    empresaLink: "https://hyliacom.es/",
    image: "/images/valenciaultramar.webp",
    mobileImage: "/images/valenciaultramar-mobile.png",
    link: "https://play.google.com/store/apps/details?id=com.hyliaapps.valenciaultramar",
    skills: ["Flutter", "Dart"],
  },
];

// Comentado temporalmente para ocultar entradas de blog
// const blogEntries = await getCollection("blog");
// const projectRelatedEntries = new Map(
//   blogEntries
//     .filter((entry) => entry.data.projectRelated)
//     .map((entry) => [entry.data.projectRelated, entry.slug])
// );

// Crear un Map vacío para no generar errores
const projectRelatedEntries = new Map();

// Añadir animaciones de transición al igual que en blog.astro
const anim = {
  old: {
    name: "slide",
    duration: "0.8s",
    easing: "cubic-bezier(0.16, 1, 0.3, 1)",
    fillMode: "forwards",
  },
  new: {
    name: "slide",
    duration: "0.8s",
    easing: "cubic-bezier(0.16, 1, 0.3, 1)",
    fillMode: "backwards",
  },
};

const customTransition = {
  forwards: anim,
  backwards: anim,
};
---

<Layout
  title="Sergio Expósito Martínez | Proyectos"
  transition:name="fade"
  transition:animate={customTransition}
>
  <div class="min-h-screen bg-[#13151a] text-neutral-100 py-16 animate-fade-in">
    <div class="container mx-auto px-4 max-w-6xl">
      <h1 class="text-5xl font-bold mb-16 tracking-tight">Proyectos</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10 fade-in">
        {
          projects.map((project, index) => {
            const blogSlug = projectRelatedEntries.get(project.title);

            return (
              <article class="group relative flex flex-col bg-gradient-to-br from-neutral-800 to-neutral-900 rounded-2xl shadow-lg overflow-hidden border border-neutral-700/30 backdrop-blur-sm hover:shadow-pink-500/10 transition-all duration-500 ease-out hover:-translate-y-2">
                <div class="relative w-full h-56 overflow-hidden">
                  <img
                    src={project.image}
                    alt={project.title}
                    class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 ease-out"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-neutral-900/70 to-transparent opacity-80" />

                  {/* Fecha destacada */}
                  <div class="absolute top-4 right-4 bg-black/50 backdrop-blur-md border border-pink-500/20 rounded-full px-3 py-1 text-xs font-medium text-pink-300">
                    {project.fecha} - {project.framework}
                  </div>
                </div>

                <div class="p-6 flex-grow flex flex-col justify-between relative z-10">
                  {/* Etiquetas en la parte superior */}
                  <div class="flex flex-wrap gap-2 mb-4">
                    {project.skills &&
                      project.skills.map((skill) => (
                        <span class="bg-pink-500/10 text-pink-300 text-xs px-3 py-1 rounded-full border border-pink-500/20 backdrop-blur-sm">
                          {skill}
                        </span>
                      ))}
                  </div>

                  <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-3 group-hover:text-pink-400 transition-colors duration-300">
                      {project.title}
                    </h2>

                    <p class="text-neutral-300 line-clamp-3 text-sm">
                      {project.description}
                    </p>
                  </div>

                  <div class="pt-4 border-t border-neutral-700/30 flex justify-between items-center mt-auto">
                    {" "}
                    <div class="flex items-center gap-2">
                      {project.empresa && (
                        <a
                          href={project.empresaLink}
                          target="_blank"
                          class="text-sm text-neutral-400 hover:text-pink-500 transition-colors"
                        >
                          {project.empresa}
                        </a>
                      )}

                      {/* Enlaces del blog ocultos temporalmente 
                      {blogSlug && (
                        <a
                          href={`/blog/${blogSlug}`}
                          class="text-sm text-pink-400 hover:text-pink-300 transition-colors flex items-center gap-1"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M12 19l7-7 3 3-7 7-3-3z" />
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" />
                            <path d="M2 2l7.586 7.586" />
                            <circle cx="11" cy="11" r="2" />
                          </svg>
                          Ver entrada del blog
                        </a>
                      )}
                      */}
                    </div>
                    {project.link && (
                      <div class="h-8 w-8 rounded-full bg-pink-500/10 flex items-center justify-center group-hover:bg-pink-500/20 transition-all duration-300">
                        <a href={project.link} target="_blank">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-4 h-4 text-pink-400 transform transition-transform group-hover:translate-x-1"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M14 5l7 7-7 7"
                            />
                          </svg>
                        </a>
                      </div>
                    )}
                  </div>
                </div>
              </article>
            );
          })
        }
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Keep existing fade-in styles */
  .fade-in {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.6s ease-out,
      transform 0.6s ease-out;
  }

  .fade-in.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Add smooth transitions */
  article {
    transition: all 0.3s ease;
  }

  article:hover {
    transform: translateY(-4px);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const faders = document.querySelectorAll(".fade-in");

    const options = {
      threshold: 0.1,
    };

    const appearOnScroll = new IntersectionObserver(function (
      entries,
      observer
    ) {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          observer.unobserve(entry.target);
        }
      });
    }, options);

    faders.forEach((fader) => {
      appearOnScroll.observe(fader);
    });
  });
</script>
